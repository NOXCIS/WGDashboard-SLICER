let peers=[];!function(){let e,t,a=window.localStorage.getItem("configurationTimeout");null!==a&&["5000","10000","30000","60000"].includes(a)||(window.localStorage.setItem("configurationTimeout","10000"),a=window.localStorage.getItem("configurationTimeout")),document.querySelector(`button[data-refresh-interval="${a}"]`).classList.add("active");let l=window.localStorage.getItem("displayMode");null!==l&&["grid","list"].includes(l)||(window.localStorage.setItem("displayMode","grid"),l="grid"),document.querySelectorAll(".display-btn-group button").forEach(e=>e.classList.remove("active")),document.querySelector(`button[data-display-mode="${l}"]`).classList.add("active");let i=$(".progress-bar"),s={keyboard:!1,backdrop:"static"},o=new bootstrap.Modal(document.getElementById("add_modal"),s),n=new bootstrap.Modal(document.getElementById("delete_bulk_modal"),s),r=new bootstrap.Modal(document.getElementById("available_ip_modal"),s),d=new bootstrap.Modal(document.getElementById("qrcode_modal"),s),c=new bootstrap.Modal(document.getElementById("setting_modal"),s),p=new bootstrap.Modal(document.getElementById("delete_modal"),s),u=new bootstrap.Modal(document.getElementById("configuration_delete_modal"),s);$("[data-toggle='tooltip']").tooltip(),$("[data-toggle='popover']").popover();let g=window.localStorage.chartUnit;null!==g&&["GB","MB","KB"].includes(g)?$(`.switchUnit[data-unit="${g}"]`).addClass("active"):(window.localStorage.setItem("chartUnit","GB"),$('.switchUnit[data-unit="GB"]').addClass("active")),g=window.localStorage.getItem("chartUnit");let m=document.getElementById("totalDataUsageChartObj").getContext("2d"),h=new Chart(m,{type:"line",data:{labels:[],datasets:[{label:"Data Sent",data:[],stroke:"#FFFFFF",borderColor:"#28a745",tension:.1,borderWidth:2},{label:"Data Received",data:[],stroke:"#FFFFFF",borderColor:"#007bff",tension:.1,borderWidth:2}]},options:{maintainAspectRatio:!1,showScale:!1,responsive:!1,scales:{y:{min:0,ticks:{min:0,callback:function(e,t,a){return`${e} ${g}`}}}},plugins:{tooltip:{callbacks:{label:function(e){return`${e.dataset.label}: ${e.parsed.y} ${g}`}}}}}}),v=$("#totalDataUsageChartObj");v.css("width","100%"),h.width=v.parent().width(),h.resize(),$(window).on("resize",function(){h.resize()}),$(".fullScreen").on("click",function(){let e=$(".chartContainer");e.hasClass("fullScreen")?($(this).children().removeClass("bi-fullscreen-exit").addClass("bi-fullscreen"),e.removeClass("fullScreen")):($(this).children().removeClass("bi-fullscreen").addClass("bi-fullscreen-exit"),e.addClass("fullScreen")),h.resize()});let b=1;function f(){$(".nav-conf-link").removeClass("active"),$(`.sb-${e}-url`).addClass("active")}$(".switchUnit").on("click",function(){if($(".switchUnit").removeClass("active"),$(this).addClass("active"),$(this).data("unit")!==g){switch($(this).data("unit")){case"GB":"MB"===g&&(b=1/1024),"KB"===g&&(b=1/1048576);break;case"MB":"GB"===g&&(b=1024),"KB"===g&&(b=1/1024);break;case"KB":"GB"===g&&(b=1048576),"MB"===g&&(b=1024)}window.localStorage.setItem("chartUnit",$(this).data("unit")),g=$(this).data("unit"),h.data.datasets[0].data=h.data.datasets[0].data.map(e=>e*b),h.data.datasets[1].data=h.data.datasets[1].data.map(e=>e*b),h.update()}});let y=!0;function k(e="Opps! <br> I can't connect to the server."){document.querySelectorAll(".no-response").forEach(e=>e.classList.add("active")),setTimeout(function(){document.querySelectorAll(".no-response").forEach(e=>e.classList.add("show")),document.querySelector("#right_body").classList.add("no-responding"),document.querySelector(".navbar").classList.add("no-responding"),document.querySelector(".no-response .container h4").innerHTML=e},10)}function w(){t=setInterval(function(){L($("#search_peer_textbox").val())},a)}function C(){clearInterval(t)}function x(){i.css("transition","3s ease-in-out").css("width","75%")}function S(e,t){let a=10**t;return Math.round(e*a)/a}$(".nav-conf-link").on("click",function(t){t.preventDefault(),e!==$(this).data("conf-id")&&(y=!0,$("#config_body").addClass("firstLoading"),e=$(this).data("conf-id"),L($("#search_peer_textbox").val())&&(f(),window.history.pushState(null,null,`/configuration/${e}`),$("title").text(`${e} | WGDashboard`),$(".index-alert").addClass("d-none").text(""),h.data.labels=[],h.data.datasets[0].data=[],h.data.datasets[1].data=[],h.update()))});let _=0,T=0,M=new Date;function L(t){M=new Date;let a=!0;return $.ajax({method:"GET",url:`/get_config/${e}?search=${encodeURIComponent(t)}`,headers:{"Content-Type":"application/json"}}).done(function(e){console.log(e),P(e)}).fail(function(){k(),a=!1}),a}function P(a){if(a.status){$(".tooltip").remove();let i=new Date-M;_+=i,T+=1,window.console.log(`Average time: ${_/T}ms`),$("#peer_loading_time").html(`Peer Loading Time: ${i}ms`),document.querySelectorAll(".no-response").forEach(e=>e.classList.remove("show")),document.querySelector("#right_body").classList.remove("no-responding"),document.querySelector(".navbar").classList.remove("no-responding"),setTimeout(function(){document.querySelectorAll(".no-response").forEach(e=>e.classList.remove("active"))},1010),peers=a.data.peer_data,function e(t){if(""===t.listen_port&&"stopped"===t.status){let a=document.createElement("div");a.classList.add("alert"),a.classList.add("alert-warning"),a.setAttribute("role","alert"),a.innerHTML="Peer QR Code and configuration file download required a specified <strong>Listen Port</strong>.",document.querySelector("#config_info_alert").appendChild(a)}if("N/A"===t.conf_address){let l=document.createElement("div");l.classList.add("alert"),l.classList.add("alert-warning"),l.setAttribute("role","alert"),l.innerHTML="Configuration <strong>Address</strong> need to be specified to have peers connect to it.",document.querySelector("#config_info_alert").appendChild(l)}}(a.data),function t(a){let l=$(".toggle--switch");if("checked"===a.checked?l.prop("checked",!0):l.prop("checked",!1),l.data("conf-id",e),a.running_peer>0){let i=new Date().toLocaleString("en-us",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"});if(h.data.labels.push(`${i}`),0===h.data.datasets[0].data.length)h.data.datasets[1].lastData=a.total_data_usage[2],h.data.datasets[0].lastData=a.total_data_usage[1],h.data.datasets[0].data.push(0),h.data.datasets[1].data.push(0);else{50===h.data.datasets[0].data.length&&50===h.data.datasets[1].data.length&&(h.data.labels.shift(),h.data.datasets[0].data.shift(),h.data.datasets[1].data.shift());let s=a.total_data_usage[2]-h.data.datasets[1].lastData,o=a.total_data_usage[1]-h.data.datasets[0].lastData,n=0;n="MB"===g?1024:"KB"===g?1048576:1,h.data.datasets[1].data.push(s*n),h.data.datasets[0].data.push(o*n),h.data.datasets[0].lastData=a.total_data_usage[1],h.data.datasets[1].lastData=a.total_data_usage[2]}h.update()}document.querySelector("#conf_name").textContent=e,$("#switch").removeClass("info_loading"),document.querySelectorAll("#sort_by_dropdown option").forEach(e=>e.removeAttribute("selected")),document.querySelector(`#sort_by_dropdown option[value="${a.sort_tag}"]`).setAttribute("selected","selected"),document.querySelector("#conf_status").innerHTML=`${a.status}<span class="dot dot-${a.status}"></span>`,document.querySelector("#conf_connected_peers").innerHTML=a.running_peer,document.querySelector("#conf_total_data_usage").innerHTML=`${a.total_data_usage[0]} GB`,document.querySelector("#conf_total_data_received").innerHTML=`${a.total_data_usage[2]} GB`,document.querySelector("#conf_total_data_sent").innerHTML=`${a.total_data_usage[1]} GB`,document.querySelector("#conf_public_key").innerHTML=a.public_key,document.querySelector("#conf_listen_port").innerHTML=""===a.listen_port?"N/A":a.listen_port,document.querySelector("#conf_address").innerHTML=a.conf_address;let r=0,d=$(".info h6");for(let c=0;c<d.length;c++)setTimeout(function(){$(d[c]).removeClass("info_loading")},r),r+=40}(a.data),function e(a){let i="";if(0===a.peer_data.length)document.querySelector(".peer_list").innerHTML=`<div class="col-12" style="text-align: center; margin-top: 1.5rem"><h3 class="text-muted">Oops! No peers found ‘︿’</h3></div>`;else{let s="list"===l?"col-12":"col-sm-6 col-lg-4";a.peer_data.forEach(function(e){let t=0,l=0;t+=e.cumu_receive,l+=e.cumu_sent;let o='<div class="w-100"></div>',n=`<div class="col-sm peerNameCol">
                        <h5 class="peerName">${""===e.name?"Untitled":e.name}</h5>
                        <h6 class="peerLightContainer"><span class="dot dot-${e.status}" style="margin-left: auto !important;" data-toggle="tooltip" data-placement="left"></span></h6>
                     </div>`,r=`<div class="col-12 peer_data_group" style="">
                        <p class="text-primary" style="">
                            <small><i class="bi bi-arrow-down-right"></i> ${S(e.total_receive+t,4)} GB</small>
                        </p>
                        <p class="text-success">
                            <small><i class="bi bi-arrow-up-right"></i> ${S(e.total_sent+l,4)} GB</small>
                        </p>
                    </div>`,d='<div class="col-sm"><small class="text-muted" style="display: flex"><strong>PEER</strong><strong style="margin-left: auto!important; opacity: 0; transition: 0.2s ease-in-out" class="text-primary">CLICK TO COPY</strong></small> <h6><samp class="ml-auto key">'+e.id+"</samp></h6></div>",c='<div class="col-sm"><small class="text-muted"><strong>ALLOWED IP</strong></small><h6 style="text-transform: uppercase;">'+e.allowed_ip+"</h6></div>",p='<div class="col-sm"> <small class="text-muted"><strong>LATEST HANDSHAKE</strong></small> <h6 style="text-transform: uppercase;">'+e.latest_handshake+"</h6> </div>",u='<div class="col-sm"><small class="text-muted"><strong>END POINT</strong></small><h6 style="text-transform: uppercase;">'+e.endpoint+"</h6></div>",g=`
                    <div class="col-sm">
                        <hr>
                        <div class="button-group" style="display:flex">
                            <button type="button" class="btn btn-outline-primary btn-setting-peer btn-control" data-peer-id="${e.id}" data-toggle="modal">
                                <i class="bi bi-gear-fill" data-toggle="tooltip" data-placement="bottom" title="Peer Settings"></i>
                            </button>
                            <button type="button" class="btn btn-outline-danger btn-delete-peer btn-control" data-peer-id="${e.id}" data-toggle="modal">
                                <i class="bi bi-x-circle-fill" data-toggle="tooltip" data-placement="bottom" title="Delete Peer"></i>
                            </button>
                            <button type="button" class="btn btn-outline-success btn-lock-peer btn-control" data-peer-id="${e.id}" data-toggle="modal">
                                <i class="bi bi-ethernet" data-toggle="tooltip" data-placement="bottom" data-original-title='Peer enabled. Click to disable peer.' data-peer-name="${e.name}"></i>
                            </button>`;""!==e.private_key&&(g+='<div class="share_peer_btn_group" style="margin-left: auto !important; display: inline"><button type="button" class="btn btn-outline-success btn-qrcode-peer btn-control" data-imgsrc="/qrcode/'+a.name+"?id="+encodeURIComponent(e.id)+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 19px;" fill="#28a745"><path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2zM15 15h2v2h-2zM13 17h2v2h-2zM17 17h2v2h-2zM19 19h2v2h-2zM15 19h2v2h-2zM17 13h2v2h-2zM19 15h2v2h-2z"/></svg></button><a href="/download/'+a.name+"?id="+encodeURIComponent(e.id)+'" class="btn btn-outline-info btn-download-peer btn-control"><i class="bi bi-download"></i></a></div>'),g+="</div>";i+='<div class="'+s+'" data-id="'+e.id+'"><div class="card mb-3 card-'+e.status+'"><div class="card-body"><div class="row">'+n+o+r+d+c+p+o+u+o+g+"</div></div></div></div></div>"}),a.lock_access_peers.forEach(function(e){let t=0,a=0;t+=e.cumu_receive,a+=e.cumu_sent;let l='<div class="w-100"></div>',o=`<div class="col-sm peerNameCol">
                        <h5 class="peerName">${""===e.name?"Untitled":e.name}</h5>
                        <h6 class="peerLightContainer"><span class="dot dot-${e.status}" style="margin-left: auto !important;" data-toggle="tooltip" data-placement="left"></span></h6>
                     </div>`,n=`<div class="col-12 peer_data_group" style="">
                        <p class="text-primary" style="">
                            <small><i class="bi bi-arrow-down-right"></i> ${S(e.total_receive+t,4)} GB</small>
                        </p>
                        <p class="text-success">
                            <small><i class="bi bi-arrow-up-right"></i> ${S(e.total_sent+a,4)} GB</small>
                        </p>
                    </div>`,r='<div class="col-sm"><small class="text-muted" style="display: flex"><strong>PEER</strong><strong style="margin-left: auto!important; opacity: 0; transition: 0.2s ease-in-out" class="text-primary">CLICK TO COPY</strong></small> <h6><samp class="ml-auto key">'+e.id+"</samp></h6></div>",d='<div class="col-sm"><small class="text-muted"><strong>ALLOWED IP</strong></small><h6 style="text-transform: uppercase;">'+e.allowed_ip+"</h6></div>",c='<div class="col-sm"> <small class="text-muted"><strong>LATEST HANDSHAKE</strong></small> <h6 style="text-transform: uppercase;">'+e.latest_handshake+"</h6> </div>",p='<div class="col-sm"><small class="text-muted"><strong>END POINT</strong></small><h6 style="text-transform: uppercase;">'+e.endpoint+"</h6></div>",u=`
                    <div class="col-sm">
                        <hr>
                        <div class="button-group" style="display:flex; align-items: center;">
                            <button type="button" class="btn btn-outline-success btn-lock-peer btn-control lock" data-peer-id="${e.id}" data-toggle="modal">
                                <i class="bi bi-ethernet" data-toggle="tooltip" data-placement="bottom" data-original-title='Peer disabled. Click to enable peer.' data-peer-name="${e.name}"></i>
                            </button>
                            <small class="text-muted" style="margin-left: auto">Peer Disabled</small>
                            </div>`;i+='<div class="'+s+'" data-id="'+e.id+'"><div class="card mb-3 card-'+e.status+'"><div class="card-body"><div class="row">'+o+l+n+r+d+c+l+p+l+u+"</div></div></div></div></div>"}),document.querySelector(".peer_list").innerHTML=i,void 0===t&&w()}}(a.data),$(".dot.dot-running").attr("title","Peer Connected").tooltip(),$(".dot.dot-stopped").attr("title","Peer Disconnected").tooltip(),$("i[data-toggle='tooltip']").tooltip(),$("#configuration_name").text(e),y&&(y=!1,$("#config_body").removeClass("firstLoading"))}else k(a.message),C()}let A=0;function q(e){$(".toastContainer").append(`<div id="${A}-toast" class="toast hide" role="alert" data-delay="5000">
				<div class="toast-header">
					<strong class="mr-auto">WGDashboard</strong>
					<button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="toast-body">${e}</div>
				<div class="toast-progressbar"></div>
			</div>`),$(`#${A}-toast`).toast("show"),$(`#${A}-toast .toast-body`).html(e),$(`#${A}-toast .toast-progressbar`).css("transition",`width ${$(`#${A}-toast .toast-progressbar`).parent().data("delay")}ms cubic-bezier(0, 0, 0, 0)`),$(`#${A}-toast .toast-progressbar`).css("width","0px"),A++}window.configurations={addModal:()=>o,deleteBulkModal:()=>n,deleteModal:()=>p,configurationDeleteModal:()=>u,ipModal:()=>r,qrcodeModal:()=>d,settingModal:()=>c,configurationTimeout:()=>a,updateDisplayMode(){l=window.localStorage.getItem("displayMode")},removeConfigurationInterval(){C()},loadPeers(e){L(e)},addPeersByBulk(){!function t(){let a=$("#new_add_amount");$add_peer.setAttribute("disabled","disabled"),$add_peer.innerHTML=`Adding ${a.val()} peers...`;let l=$("#new_add_DNS");l.val(window.configurations.cleanIp(l.val()));let i=$("#new_add_endpoint_allowed_ip");i.val(window.configurations.cleanIp(i.val()));let s=$("#new_add_MTU"),o=$("#new_add_keep_alive"),n=$("#enable_preshare_key"),r=[l,i,s,o];if(a.val()>0&&!a.hasClass("is-invalid")){if(""!==l.val()&&""!==i.val()){let d=e,c=[];for(let p=0;p<a.val();p++)c.push(window.wireguard.generateKeypair());$.ajax({method:"POST",url:"/add_peer_bulk/"+d,headers:{"Content-Type":"application/json"},data:JSON.stringify({DNS:l.val(),endpoint_allowed_ip:i.val(),MTU:s.val(),keep_alive:o.val(),enable_preshared_key:n.prop("checked"),keys:c,amount:a.val()}),success:function(e){"true"!==e?($("#add_peer_alert").html(e).removeClass("d-none"),r.forEach(e=>e.removeAttr("disabled")),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save"):(window.configurations.loadPeers(""),r.forEach(e=>e.removeAttr("disabled")),$("#add_peer_form").trigger("reset"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save",window.configurations.showToast(a.val()+" peers added successful!"),window.configurations.addModal().toggle())}})}else $("#add_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}else $add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}()},deletePeers(e,t){var a,l;a=e,l=t,$.ajax({method:"POST",url:"/remove_peer/"+a,headers:{"Content-Type":"application/json"},data:JSON.stringify({action:"delete",peer_ids:l}),success:function(e){if("true"!==e){if(window.configurations.deleteModal()._isShown&&($("#remove_peer_alert").html(e+$("#add_peer_alert").html()).removeClass("d-none"),$("#delete_peer").removeAttr("disabled").html("Delete")),window.configurations.deleteBulkModal()._isShown){let t=$("#bulk_remove_peer_alert");t.html(e+t.html()).removeClass("d-none"),$("#confirm_delete_bulk_peers").removeAttr("disabled").html("Delete")}}else window.configurations.deleteModal()._isShown&&window.configurations.deleteModal().toggle(),window.configurations.deleteBulkModal()._isShown&&($("#confirm_delete_bulk_peers").removeAttr("disabled").html("Delete"),$("#selected_peer_list").html(""),$(".delete-bulk-peer-item.active").removeClass("active"),window.configurations.deleteBulkModal().toggle()),window.configurations.loadPeers($("#search_peer_textbox").val()),window.configurations.showToast(`Deleted ${l.length} peers`),$("#delete_peer").removeAttr("disabled").html("Delete")}})},deleteConfiguration(){},parsePeers(e){P(e)},toggleAccess(t){!function t(a){$.ajax({url:"/api/togglePeerAccess",method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({peerID:a,config:e})}).done(function(e){e.status?L($("#search_peer_textbox").val()):q(e.reason)})}(t)},setConfigurationName(t){e=t},getConfigurationName:()=>e,setActiveConfigurationName(){f()},getAvailableIps(){$.ajax({url:`/available_ips/${e}`,method:"GET"}).done(function(e){if(!0===e.status){available_ips=e.data;let t=document.querySelector("#available_ip_modal .modal-body .list-group");t.innerHTML="",document.querySelector("#allowed_ips").value=available_ips[0],available_ips.forEach(e=>t.innerHTML+=`<a class="list-group-item list-group-item-action available-ip-item" style="cursor: pointer" data-ip="${e}">${e}</a>`)}else document.querySelector("#allowed_ips").value=e.message,document.querySelector("#search_available_ip").setAttribute("disabled","disabled")})},generateKeyPair(){let e;e=window.wireguard.generateKeypair(),document.querySelector("#private_key").value=e.privateKey,document.querySelector("#public_key").value=e.publicKey,document.querySelector("#add_peer_alert").classList.add("d-none"),document.querySelector("#re_generate_key i").classList.remove("rotating"),document.querySelector("#enable_preshare_key").value=e.presharedKey},showToast(e){q(e)},updateRefreshInterval(e){var t;a=t=e,window.localStorage.setItem("configurationTimeout",a.toString()),C(),w(),q("Refresh Interval set to "+Math.round(t/1e3)+" seconds")},copyToClipboard(e){var t;let a;t=e,a=$("<input>"),$body.append(a),a.val($(t).text()).trigger("select"),document.execCommand("copy"),a.remove()},toggleDeleteByBulkIP(e){var t;let a,l,i;t=e,a=$("#selected_peer_list"),l=t.data("id"),i=""===t.data("name")?"Untitled Peer":t.data("name"),t.hasClass("active")?(t.removeClass("active"),$("#selected_peer_list .badge[data-id='"+l+"']").remove()):(t.addClass("active"),a.append('<span class="badge badge-danger delete-peer-bulk-badge" style="cursor: pointer; text-overflow: ellipsis; max-width: 100%; overflow-x: hidden" data-id="'+l+'">'+i+" - "+l+"</span>"))},downloadOneConfig(e){var t;let a,l;t=e,(a=document.createElement("a")).download=t.filename,l=new Blob([t.content],{type:"text/conf"}),a.href=window.URL.createObjectURL(l),a.click()},triggerIp(e){var t;let a;t=e,(a=document.querySelector(`.available-ip-item[data-ip='${t}']`))&&(a.classList.contains("active")?(a.classList.remove("active"),document.querySelector(`#selected_ip_list .badge[data-ip='${t}']`).remove()):(a.classList.add("active"),document.querySelector("#selected_ip_list").innerHTML+=`<span class="badge badge-primary available-ip-badge" style="cursor: pointer" data-ip="${t}">${t}</span>`))},cleanIp:e=>(function e(t){let a=t.split(",");for(let l=0;l<a.length;l++)a[l]=a[l].trim(" ");return a.filter(Boolean).join(",")})(e),startProgressBar(){i.css("width","0%").css("opacity","100").css("background","rgb(255,69,69)").css("background","linear-gradient(145deg, rgba(255,69,69,1) 0%, rgba(0,115,186,1) 100%)").css("width","25%"),setTimeout(function(){x()},300)},stillLoadingProgressBar(){x()},endProgressBar(){i.css("transition","0.3s ease-in-out").css("width","100%"),setTimeout(function(){i.css("opacity","0")},250)}}}();let $body=$("body"),available_ips=[],$add_peer=document.getElementById("save_peer");function ajaxPostJSON(e,t,a){$.ajax({url:e,method:"POST",data:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).done(function(e){a(e)})}$("#configuration_delete").on("click",function(){window.configurations.configurationDeleteModal().toggle()}),$("#sure_delete_configuration").on("click",function(){window.configurations.removeConfigurationInterval();let e=$(this);e.attr("disabled","disabled"),ajaxPostJSON("/api/deleteConfiguration",{name:window.configurations.getConfigurationName()},function t(a){a.status?($('#configuration_delete_modal button[data-dismiss="modal"]').remove(),e.text("Delete Successful! Redirecting in 5 seconds."),setTimeout(function(){window.location.replace("/")},5e3)):$("#remove_configuration_alert").removeClass("d-none").text(a.reason)})}),document.querySelector(".add_btn").addEventListener("click",()=>{window.configurations.addModal().toggle()}),$(".toggle--switch").on("change",function(){console.log("lol"),$(this).addClass("waiting").attr("disabled","disabled");let e=window.configurations.getConfigurationName(),t=$(this).prop("checked"),a=$(this);$.ajax({url:`/switch/${e}`}).done(function(l){l.status?t?window.configurations.showToast(`${e} is running.`):window.configurations.showToast(`${e} is stopped.`):(t?a.prop("checked",!1):a.prop("checked",!0),window.configurations.showToast(l.reason),$(".index-alert").removeClass("d-none").text(`Configuration toggle failed. Please check the following error message:
${l.message}`)),a.removeClass("waiting"),a.removeAttr("disabled"),window.configurations.loadPeers($("#search_peer_textbox").val())})}),document.querySelector("#private_key").addEventListener("change",e=>{let t=document.querySelector("#public_key");44===e.target.value.length?(t.value=window.wireguard.generatePublicKey(e.target.value),t.setAttribute("disabled","disabled")):(t.attributes.removeNamedItem("disabled"),t.value="")}),$("#add_modal").on("show.bs.modal",function(){window.configurations.generateKeyPair(),window.configurations.getAvailableIps()}).on("hide.bs.modal",function(){$("#allowed_ips_indicator").html("")}),$("#re_generate_key").on("click",function(){$("#public_key").attr("disabled","disabled"),$("#re_generate_key i").addClass("rotating"),window.configurations.generateKeyPair()}),$("#allowed_ips").on("keyup",function(){let e=window.configurations.cleanIp($(this).val());e=e.split(","),available_ips.includes(e[e.length-1])?$("#allowed_ips_indicator").removeClass().addClass("text-success").html('<i class="bi bi-check-circle-fill"></i>'):$("#allowed_ips_indicator").removeClass().addClass("text-warning").html('<i class="bi bi-exclamation-circle-fill"></i>')}),$("#peer_name_textbox").on("keyup",function(){$(".peer_name").html($(this).val())}),$add_peer.addEventListener("click",function(){if($("#bulk_add").prop("checked"))$("#new_add_amount").hasClass("is-invalid")||window.configurations.addPeersByBulk();else{let e=$("#public_key"),t=$("#private_key"),a=$("#allowed_ips");a.val(window.configurations.cleanIp(a.val()));let l=$("#new_add_DNS");l.val(window.configurations.cleanIp(l.val()));let i=$("#new_add_endpoint_allowed_ip");i.val(window.configurations.cleanIp(i.val()));let s=$("#new_add_name"),o=$("#new_add_MTU"),n=$("#new_add_keep_alive"),r=$("#enable_preshare_key");if($add_peer.setAttribute("disabled","disabled"),$add_peer.innerHTML="Adding...",""!==a.val()&&""!==e.val()&&""!==l.val()&&""!==i.val()){let d=window.configurations.getConfigurationName(),c=[t,a,s,l,i,o,n];c.forEach(e=>e.attr("disabled","disabled")),$.ajax({method:"POST",url:"/add_peer/"+d,headers:{"Content-Type":"application/json"},data:JSON.stringify({private_key:t.val(),public_key:e.val(),allowed_ips:a.val(),name:s.val(),DNS:l.val(),endpoint_allowed_ip:i.val(),MTU:o.val(),keep_alive:n.val(),enable_preshared_key:r.prop("checked"),preshared_key:r.val()}),success:function(e){"true"!==e?($("#add_peer_alert").html(e).removeClass("d-none"),c.forEach(e=>e.removeAttr("disabled")),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save"):(window.configurations.loadPeers(""),c.forEach(e=>e.removeAttr("disabled")),$("#add_peer_form").trigger("reset"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Save",window.configurations.showToast("Add peer successful!"),window.configurations.addModal().toggle())}})}else $("#add_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$add_peer.removeAttribute("disabled"),$add_peer.innerHTML="Add"}}),$("#new_add_amount").on("keyup",function(){let e=$("#bulk_amount_validation");$(this).val().length>0?isNaN($(this).val())?($(this).removeClass("is-valid").addClass("is-invalid"),e.html("Please enter a valid integer")):$(this).val()>available_ips.length?($(this).removeClass("is-valid").addClass("is-invalid"),e.html(`Cannot create more than ${available_ips.length} peers.`)):1>$(this).val()?($(this).removeClass("is-valid").addClass("is-invalid"),e.html("Please enter at least 1 or more.")):$(this).removeClass("is-invalid").addClass("is-valid"):$(this).removeClass("is-invalid").removeClass("is-valid")}),$("#bulk_add").on("change",function(){let e=$(".non-bulk"),t=$("#new_add_amount");if(!0===$(this).prop("checked")){for(let a=0;a<e.length;a++)$(e[a]).attr("disabled","disabled");t.removeAttr("disabled")}else{for(let l=0;l<e.length;l++)"public_key"!==$(e[l]).attr("id")&&$(e[l]).removeAttr("disabled");t.attr("disabled","disabled")}}),$("#available_ip_modal").on("show.bs.modal",()=>{document.querySelector("#add_modal").classList.add("ip_modal_open")}).on("hidden.bs.modal",()=>{document.querySelector("#add_modal").classList.remove("ip_modal_open");let e=[],t=document.querySelector("#selected_ip_list");for(let a=0;a<t.childElementCount;a++)e.push(t.children[a].dataset.ip);e.forEach(e=>window.configurations.triggerIp(e))}),$body.on("click",".available-ip-badge",function(){$(".available-ip-item[data-ip='"+$(this).data("ip")+"']").removeClass("active"),$(this).remove()}),$body.on("click",".available-ip-item",function(){window.configurations.triggerIp($(this).data("ip"))}),$("#search_available_ip").on("click",function(){window.configurations.ipModal().toggle();let e=document.querySelector("#allowed_ips");if(e.value.length>0){let t=e.value.split(",");for(let a=0;a<t.length;a++)t[a]=t[a].trim(),window.configurations.triggerIp(t[a])}}).tooltip(),$("#confirm_ip").on("click",()=>{window.configurations.ipModal().toggle();let e=[];$("#selected_ip_list").children().each(function(){e.push($(this).data("ip"))}),$("#allowed_ips").val(e.join(", ")),e.forEach(e=>window.configurations.triggerIp(e))}),$body.on("click",".btn-qrcode-peer",function(){let e=$(this).data("imgsrc");$.ajax({url:e,method:"GET"}).done(function(e){$("#qrcode_img").attr("src",e),window.configurations.qrcodeModal().toggle()})}),$body.on("click",".btn-delete-peer",function(){let e=$(this).data("peer-id");$("#delete_peer").data("peer-id",e),window.configurations.deleteModal().toggle()}),$body.on("click",".btn-lock-peer",function(){window.configurations.toggleAccess($(this).data("peer-id"),window.configurations.getConfigurationName()),$(this).hasClass("lock")?(console.log($(this).data("peer-name")),window.configurations.showToast(`Enabled ${$(this).children().data("peer-name")}`),$(this).removeClass("lock"),$(this).children().tooltip("hide").attr("data-original-title","Peer enabled. Click to disable peer.").tooltip("show")):(window.configurations.showToast(`Disabled ${$(this).children().data("peer-name")}`),$(this).addClass("lock"),$(this).children().tooltip("hide").attr("data-original-title","Peer disabled. Click to enable peer.").tooltip("show"))}),$("#delete_peer").on("click",function(){$(this).attr("disabled","disabled"),$(this).html("Deleting...");let e=window.configurations.getConfigurationName(),t=[$(this).data("peer-id")];window.configurations.deletePeers(e,t)}),$body.on("click",".btn-setting-peer",function(){let e=$(this).data("peer-id");$("#save_peer_setting").attr("peer_id",e),$.ajax({method:"POST",url:"/get_peer_data/"+window.configurations.getConfigurationName(),headers:{"Content-Type":"application/json"},data:JSON.stringify({id:e}),success:function(e){let t=""===e.name?"Untitled":e.name;$("#setting_modal .peer_name").html(t),$("#setting_modal #peer_name_textbox").val(e.name),$("#setting_modal #peer_private_key_textbox").val(e.private_key),$("#setting_modal #peer_DNS_textbox").val(e.DNS),$("#setting_modal #peer_allowed_ip_textbox").val(e.allowed_ip),$("#setting_modal #peer_endpoint_allowed_ips").val(e.endpoint_allowed_ip),$("#setting_modal #peer_mtu").val(e.mtu),$("#setting_modal #peer_keep_alive").val(e.keep_alive),$("#setting_modal #peer_preshared_key_textbox").val(e.preshared_key),window.configurations.settingModal().toggle(),window.configurations.endProgressBar()}})}),$("#setting_modal").on("hidden.bs.modal",function(){$("#setting_peer_alert").addClass("d-none")}),$("#peer_private_key_textbox").on("change",function(){let e=$("#save_peer_setting");$(this).val().length>0&&$.ajax({url:"/check_key_match/"+window.configurations.getConfigurationName(),method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify({private_key:$("#peer_private_key_textbox").val(),public_key:e.attr("peer_id")})}).done(function(e){"failed"===e.status?$("#setting_peer_alert").html(e.status).removeClass("d-none"):$("#setting_peer_alert").addClass("d-none")})}),$("#save_peer_setting").on("click",function(){$(this).attr("disabled","disabled"),$(this).html("Saving...");let e=$("#peer_DNS_textbox"),t=$("#peer_allowed_ip_textbox"),a=$("#peer_endpoint_allowed_ips"),l=$("#peer_name_textbox"),i=$("#peer_private_key_textbox"),s=$("#peer_preshared_key_textbox"),o=$("#peer_mtu"),n=$("#peer_keep_alive");if(""!==e.val()&&""!==t.val()&&""!==a.val()){let r=$(this).attr("peer_id"),d=$(this).attr("conf_id"),c=[l,e,i,s,t,a,o,n];c.forEach(e=>e.attr("disabled","disabled")),$.ajax({method:"POST",url:"/save_peer_setting/"+d,headers:{"Content-Type":"application/json"},data:JSON.stringify({id:r,name:l.val(),DNS:e.val(),private_key:i.val(),allowed_ip:t.val(),endpoint_allowed_ip:a.val(),MTU:o.val(),keep_alive:n.val(),preshared_key:s.val()}),success:function(e){"failed"===e.status?$("#setting_peer_alert").html(e.msg).removeClass("d-none"):(window.configurations.settingModal().toggle(),window.configurations.loadPeers($("#search_peer_textbox").val()),$("#alertToast").toast("show"),$("#alertToast .toast-body").html("Peer Saved!")),$("#save_peer_setting").removeAttr("disabled").html("Save"),c.forEach(e=>e.removeAttr("disabled"))}})}else $("#setting_peer_alert").html("Please fill in all required box.").removeClass("d-none"),$("#save_peer_setting").removeAttr("disabled").html("Save")}),$(".peer_private_key_textbox_switch").on("click",function(){let e=$("#peer_private_key_textbox"),t="password"===e.attr("type")?"text":"password",a="password"===e.attr("type")?"bi bi-eye-slash-fill":"bi bi-eye-fill";e.attr("type",t),$(".peer_private_key_textbox_switch i").removeClass().addClass(a)});let typingTimer,doneTypingInterval=200;$("#search_peer_textbox").on("keyup",function(){clearTimeout(typingTimer),typingTimer=setTimeout(()=>{window.configurations.loadPeers($(this).val())},doneTypingInterval)}).on("keydown",function(){clearTimeout(typingTimer)}),$body.on("change","#sort_by_dropdown",function(){$.ajax({method:"POST",data:JSON.stringify({sort:$("#sort_by_dropdown option:selected").val()}),headers:{"Content-Type":"application/json"},url:"/update_dashboard_sort",success:function(){window.configurations.loadPeers($("#search_peer_textbox").val())}})}),$body.on("mouseenter",".key",function(){$(this).parent().siblings().children()[1].style.opacity="100"}).on("mouseout",".key",function(){let e=$(this).parent().siblings().children()[1];e.style.opacity="0",setTimeout(function(){e.innerHTML="CLICK TO COPY"},200)}).on("click",".key",function(){let e=$(this).parent().siblings().children()[1];window.configurations.copyToClipboard($(this)),e.innerHTML="COPIED!"}),$body.on("click",".update_interval",function(){$(".interval-btn-group button").removeClass("active");$(this).addClass("active");let e=$(this).data("refresh-interval");[5e3,1e4,3e4,6e4].includes(e)&&window.configurations.updateRefreshInterval(e)}),$body.on("click",".refresh",function(){window.configurations.loadPeers($("#search_peer_textbox").val())}),$body.on("click",".display_mode",function(){$(".display-btn-group button").removeClass("active"),$(this).addClass("active"),window.localStorage.setItem("displayMode",$(this).data("display-mode")),window.configurations.updateDisplayMode(),"list"===$(this).data("display-mode")?(Array($(".peer_list").children()).forEach(function(e){$(e).removeClass().addClass("col-12")}),window.configurations.showToast("Displaying as List")):(Array($(".peer_list").children()).forEach(function(e){$(e).removeClass().addClass("col-sm-6 col-lg-4")}),window.configurations.showToast("Displaying as Grids"))});let $setting_btn_menu=$(".setting_btn_menu");$setting_btn_menu.css("top",-(($setting_btn_menu.height()+54)*1));let $setting_btn=$(".setting_btn");$setting_btn.on("click",function(){$setting_btn_menu.hasClass("show")?($setting_btn_menu.removeClass("showing"),setTimeout(function(){$setting_btn_menu.removeClass("show")},201)):($setting_btn_menu.addClass("show"),setTimeout(function(){$setting_btn_menu.addClass("showing")},10))}),$("html").on("click",function(e){document.querySelector(".setting_btn")===e.target||document.querySelector(".setting_btn").contains(e.target)||document.querySelector(".setting_btn_menu").contains(e.target)||($setting_btn_menu.removeClass("showing"),setTimeout(function(){$setting_btn_menu.removeClass("show")},310))}),$("#delete_peers_by_bulk_btn").on("click",()=>{let e=$("#delete_bulk_modal .list-group");e.html(""),peers.forEach(t=>{let a;a=""===t.name?"Untitled Peer":t.name,e.append('<a class="list-group-item list-group-item-action delete-bulk-peer-item" style="cursor: pointer" data-id="'+t.id+'" data-name="'+a+'">'+a+"<br><code>"+t.id+"</code></a>")}),window.configurations.deleteBulkModal().toggle()}),$body.on("click",".delete-bulk-peer-item",function(){window.configurations.toggleDeleteByBulkIP($(this))}).on("click",".delete-peer-bulk-badge",function(){window.configurations.toggleDeleteByBulkIP($(".delete-bulk-peer-item[data-id='"+$(this).data("id")+"']"))});let $selected_peer_list=document.getElementById("selected_peer_list"),changeObserver=new MutationObserver(function(){$selected_peer_list.hasChildNodes()?$("#confirm_delete_bulk_peers").removeAttr("disabled"):$("#confirm_delete_bulk_peers").attr("disabled","disabled")});changeObserver.observe($selected_peer_list,{attributes:!0,childList:!0,characterData:!0});let confirm_delete_bulk_peers_interval;$("#confirm_delete_bulk_peers").on("click",function(){let e=$(this);if(void 0!==confirm_delete_bulk_peers_interval)clearInterval(confirm_delete_bulk_peers_interval),confirm_delete_bulk_peers_interval=void 0,e.html("Delete");else{let t=5;e.html(`Deleting in ${t} secs... Click to cancel`),confirm_delete_bulk_peers_interval=setInterval(function(){if(t-=1,e.html(`Deleting in ${t} secs... Click to cancel`),0===t){e.html("Deleting..."),e.attr("disabled","disabled");let a=[];$selected_peer_list.childNodes.forEach(e=>a.push(e.dataset.id)),window.configurations.deletePeers(window.configurations.getConfigurationName(),a),clearInterval(confirm_delete_bulk_peers_interval),confirm_delete_bulk_peers_interval=void 0}},1e3)}}),$("#select_all_delete_bulk_peers").on("click",function(){$(".delete-bulk-peer-item").each(function(){$(this).hasClass("active")||window.configurations.toggleDeleteByBulkIP($(this))})}),$(window.configurations.deleteBulkModal()._element).on("hidden.bs.modal",function(){$(".delete-bulk-peer-item").each(function(){$(this).hasClass("active")&&window.configurations.toggleDeleteByBulkIP($(this))})}),$body.on("click",".btn-download-peer",function(e){e.preventDefault();let t=$(this).attr("href");$.ajax({url:t,method:"GET",success:function(e){window.configurations.downloadOneConfig(e)}})}),$("#download_all_peers").on("click",function(){$.ajax({url:`/download_all/${window.configurations.getConfigurationName()}`,method:"GET",success:function(e){e.peers.length>0?(window.wireguard.generateZipFiles(e),window.configurations.showToast("Peers' zip file download successful!")):window.configurations.showToast("Oops! There are no peer can be download.")}})});